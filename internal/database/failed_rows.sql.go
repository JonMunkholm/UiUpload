// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: failed_rows.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countFailedRowsByUploadId = `-- name: CountFailedRowsByUploadId :one
SELECT COUNT(*) FROM upload_failed_rows WHERE upload_id = $1
`

func (q *Queries) CountFailedRowsByUploadId(ctx context.Context, uploadID pgtype.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countFailedRowsByUploadId, uploadID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const deleteFailedRowsByUploadId = `-- name: DeleteFailedRowsByUploadId :exec
DELETE FROM upload_failed_rows WHERE upload_id = $1
`

func (q *Queries) DeleteFailedRowsByUploadId(ctx context.Context, uploadID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteFailedRowsByUploadId, uploadID)
	return err
}

const getFailedRowsByUploadId = `-- name: GetFailedRowsByUploadId :many
SELECT id, upload_id, line_number, reason, row_data, created_at
FROM upload_failed_rows
WHERE upload_id = $1
ORDER BY line_number
`

func (q *Queries) GetFailedRowsByUploadId(ctx context.Context, uploadID pgtype.UUID) ([]UploadFailedRow, error) {
	rows, err := q.db.Query(ctx, getFailedRowsByUploadId, uploadID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []UploadFailedRow{}
	for rows.Next() {
		var i UploadFailedRow
		if err := rows.Scan(
			&i.ID,
			&i.UploadID,
			&i.LineNumber,
			&i.Reason,
			&i.RowData,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertFailedRow = `-- name: InsertFailedRow :exec
INSERT INTO upload_failed_rows (upload_id, line_number, reason, row_data)
VALUES ($1, $2, $3, $4)
`

type InsertFailedRowParams struct {
	UploadID   pgtype.UUID `json:"upload_id"`
	LineNumber int32       `json:"line_number"`
	Reason     string      `json:"reason"`
	RowData    []string    `json:"row_data"`
}

func (q *Queries) InsertFailedRow(ctx context.Context, arg InsertFailedRowParams) error {
	_, err := q.db.Exec(ctx, insertFailedRow,
		arg.UploadID,
		arg.LineNumber,
		arg.Reason,
		arg.RowData,
	)
	return err
}
